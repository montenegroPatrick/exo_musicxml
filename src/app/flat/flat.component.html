<div
  class="h-screen flex flex-col text-secondary w-screen items-center justify-start"
>
  @if(isXmlError()) {
  <app-error-message />
  } @else {
  <!-- Flat.io Editor Container -->
  <div
    class="w-[90%] text-center md:max-w-[80%] flex-1 max-h-[50%] no-scrollbar"
    #flatContainer
  ></div>

  <!-- Tap Visualizer (when playing or finished) -->
  @if(exerciseState.isPlaying() || exerciseState.exerciseStatus() === 'finish')
  {
  <app-tap-visualizer />
  }
  <!-- Main Content -->
  @if(exerciseState.exerciseStatus() === 'finish') {
  <!-- Results Screen -->
  <app-exercise-results
    [percentage]="exerciseState.resultPercentage()"
    (restart)="resetExercice()"
    (continue)="handleContinue()"
  />
  } @else {
  <!-- Countdown Display -->
  <app-countdown-display
    [status]="metronome.countInStatus()"
    [tick]="metronome.metronomeTick()"
  >
    @if(!exerciseState.isPlaying()) {
    <app-control-buttons
      [isPlaying]="exerciseState.isPlaying()"
      [xmlLoaded]="exerciseState.xmlIsLoaded()"
      (playStop)="handlePlayStop()"
    />
    }
  </app-countdown-display>
  }

  <!-- Tap Button (when playing and not finished) -->
  @if(exerciseState.isPlaying() && exerciseState.exerciseStatus() !== 'finish')
  {
  <app-tap-button
    [disabled]="!exerciseState.canTap()"
    [lastTap]="exerciseState.lastTap()"
    (tap)="handleUserTap()"
  >
    <app-control-buttons
      [isPlaying]="exerciseState.isPlaying()"
      [xmlLoaded]="exerciseState.xmlIsLoaded()"
      (playStop)="handlePlayStop()"
    />
  </app-tap-button>
  } }
</div>
